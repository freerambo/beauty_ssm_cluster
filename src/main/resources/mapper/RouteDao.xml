<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.cruiser.dao.RouteDao">


	<select id="fetchOneByMerchantId" resultType="Route">
		SELECT *
		FROM routes
		WHERE merchant_id=#{merchantId}
		ORDER BY priority desc
		limit 1
	</select>

	<select id="fetchOneByMerchantCode" resultType="Route">
		SELECT a.*
		FROM routes a INNER JOIN `merchants` b on a.`merchant_id` = b.`merchant_id`
		WHERE b.`merchant_code` = #{merchantCode}
		ORDER BY a.priority desc
		limit 1
	</select>

	<select id="queryByMerchantId" resultType="Route">
		SELECT *
		FROM routes
		WHERE merchant_id=#{merchantId}
		limit #{offset},#{limit}
	</select>

	<select id="queryByUpstreamId" resultType="Route">
		SELECT *
		FROM routes
		WHERE upstream_id=#{upstreamId}
		limit #{offset},#{limit}
	</select>

</mapper>