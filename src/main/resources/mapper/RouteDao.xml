<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.cruiser.dao.RouteDao">


	<insert id="insert" parameterType="Route" useGeneratedKeys="true"
			keyProperty="routeId">
		INSERT INTO
		routes(merchant_id, weixin_route, alipay_route, priority)
		VALUES
		(#{merchantId},#{weixinRoute},#{alipayRoute},#{priority})
	</insert>

	<update id="update" parameterType="Route">
		UPDATE routes
		<trim prefix="SET" suffixOverrides=",">
			<if test="merchantId!=null">merchant_id=#{merchantId},</if>
			<if test="weixinRoute!=null">weixin_route=#{weixinRoute},</if>
			<if test="alipayRoute!=null">alipay_route=#{alipayRoute},</if>
			<if test="priority!=null">priority=#{priority},</if>
		</trim>
		WHERE route_id = #{routeId}
	</update>

	<select id="fetchOneByMerchantId" resultType="Route">
		SELECT *
		FROM routes
		WHERE merchant_id=#{merchantId}
		ORDER BY priority desc
		limit 1
	</select>

	<select id="fetchOneByMerchantCode" resultType="Route">
		SELECT a.*
		FROM routes a INNER JOIN `merchants` b on a.`merchant_id` = b.`merchant_id`
		WHERE b.`merchant_code` = #{merchantCode}
		ORDER BY a.priority desc
		limit 1
	</select>

	<select id="queryByMerchantId" resultType="Route">
		SELECT *
		FROM routes
		WHERE merchant_id=#{merchantId}
	</select>

	<select id="queryAll" resultType="Route">
		SELECT *
		FROM routes
		ORDER BY
		priority DESC
		limit #{offset},#{limit}
	</select>

</mapper>